<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Site Admin | Highfield Road Christmas Lights 🎄</title>

    <!-- ✅ Tailwind 3.4.17 (stable & supported) -->
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Christmas Theme Styles -->
    <style>
      body {
        background: linear-gradient(to bottom, #0b1221, #101a33);
        color: white;
        font-family: "Roboto", sans-serif;
      }
      h1, h2, h3 { font-family: "Poppins", sans-serif; }
      .text-glow { text-shadow: 0 0 8px rgba(255,255,255,0.6); }
      .bg-christmas-red { background-color: #e63946; }
      .text-christmas-gold { color: #f4d35e; }
      .border-christmas-gold { border-color: #f4d35e; }
      .bg-christmas-gradient { background: linear-gradient(to right, #e63946, #2a9d8f, #f4d35e); }
      .fade-in-up {
        opacity: 1 !important;
        transform: translateY(0) !important;
        transition: all 0.7s ease;
      }
    </style>
  </head>

  <body>
    <!-- Load Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const initCMS = () => {
          if (typeof window.CMS === "undefined" || typeof window.React === "undefined") {
            // Wait until Decap + React fully load
            return setTimeout(initCMS, 200);
          }

          const React = window.React;
          const { createElement } = React;

          /* 🎨 Inject Tailwind + Fonts into CMS Preview iframe */
          CMS.registerPreviewStyle("https://cdn.tailwindcss.com/3.4.17");
          CMS.registerPreviewStyle(
            "https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@400;500&display=swap"
          );
          CMS.registerPreviewStyle("", {
            raw: `
              body {
                background: linear-gradient(to bottom, #0b1221, #101a33);
                color: white;
                font-family: 'Roboto', sans-serif;
                padding: 2rem;
              }
              h1, h2, h3 { font-family: 'Poppins', sans-serif; }
              .text-glow { text-shadow: 0 0 8px rgba(255,255,255,0.6); }
              .bg-christmas-red { background-color: #e63946; }
              .text-christmas-gold { color: #f4d35e; }
              .border-christmas-gold { border-color: #f4d35e; }
              .bg-christmas-gradient {
                background: linear-gradient(to right, #e63946, #2a9d8f, #f4d35e);
              }
            `,
          });

          /* =============== 🕯️ About Section Preview =============== */
          const AboutPreview = ({ entry }) => {
            const data = entry.getIn(["data"]).toJS();
            return createElement(
              "section",
              { className: "relative py-16 text-center" },
              createElement(
                "h2",
                { className: "text-4xl font-bold mb-8 text-white text-glow" },
                data.title
              ),
              createElement(
                "div",
                { className: "max-w-4xl mx-auto space-y-8" },
                data.cards?.map((card) =>
                  createElement(
                    "div",
                    {
                      className:
                        "p-6 bg-white/10 backdrop-blur-md rounded-xl border border-white/20 shadow-md text-left",
                    },
                    createElement(
                      "div",
                      { className: "flex gap-4 items-start" },
                      createElement("i", {
                        "data-lucide": card.icon,
                        class: "text-christmas-gold w-6 h-6 mt-1",
                      }),
                      createElement(
                        "div",
                        {},
                        createElement(
                          "h3",
                          { className: "text-2xl font-semibold mb-2 text-white" },
                          card.heading
                        ),
                        card.text?.map((p) =>
                          createElement(
                            "p",
                            { className: "text-gray-300 mb-2" },
                            p
                          )
                        )
                      )
                    )
                  )
                )
              )
            );
          };

          /* Register Preview Templates */
          CMS.registerPreviewTemplate("about", AboutPreview);

          /* Initialize Lucide icons */
          CMS.registerEventListener({
            name: "preSave",
            handler: () => {
              setTimeout(() => {
                if (window.lucide) window.lucide.createIcons();
              }, 300);
            },
          });

          console.log("🎄 Decap CMS initialized successfully with Tailwind 3.4.17 + React ready");
        };

        initCMS();
      });
    </script>
  </body>
</html>
